<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Returns query distribution and connection statistics</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="ref.mysqlnd-ms.html">Mysqlnd_ms Functions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysqlnd-ms-query-is-select.html">mysqlnd_ms_query_is_select</a></div>
 <div class="up"><a href="ref.mysqlnd-ms.html">Mysqlnd_ms Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mysqlnd-ms-get-stats" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqlnd_ms_get_stats</h1>
  <p class="verinfo">(PECL mysqlnd_ms &gt;= 1.0.0)</p><p class="refpurpose"><span class="refname">mysqlnd_ms_get_stats</span> &mdash; <span class="dc-title">Returns query distribution and connection statistics</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mysqlnd-ms-get-stats-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span>
    <span class="methodname"><b>mysqlnd_ms_get_stats</b></span>
    ( <span class="methodparam">void</span>
   )</div>

  <p class="para rdfs-comment">
   Returns an array of statistics collected by the replication 
   and load balancing plugin.
  </p>
  <p class="para">
   The PHP configuration setting
   <i><a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.collect_statistics" class="link">mysqlnd_ms.collect_statistics</a></i>
   controls the collection of statistics. The collection of statistics
   is disabled by default for performance reasons.
  </p>  
  <p class="para">
   The scope of the statistics is the
   <i>PHP</i> process.
   Depending on your deployment model a
   <i>PHP</i> process may handle one or multiple requests.
  </p>
  <p class="para">
   Statistics are aggregated for all connections. It is not possible
   to tell how much queries originating from
   <i>mysqli</i>,
   <i>PDO_MySQL</i> or
   <i>mysql</i> API calls have
   contributed to the aggregated data values.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysqlnd-ms-get-stats-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">This function has no parameters.</p>
 </div>


<div class="refsect1 returnvalues" id="refsect1-function.mysqlnd-ms-get-stats-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns <i>NULL</i> if 
   the PHP configuration directive 
   <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.enable" class="link"><i>mysqlnd_ms.enable</i></a>
   has disabled the plugin. Otherwise, returns array of statistics.
  </p>
  <p class="para">
   Array of statistics
  </p>
  <table class="doctable informaltable">
   
    <col align="left" width="10" />
    <col align="left" width="70" />
    <col align="left" width="20" />
    <thead valign="middle">
     <tr valign="middle">
      <th>Statistic</th>
      <th>Description</th>
      <th>Version</th>
     </tr>

    </thead>

    <tbody valign="middle" class="tbody">
     <tr valign="middle">
      <td align="left">
       <i>use_slave</i>
      </td>
      <td align="left">
       Number of statements considered as read-only by the built-in query analyzer.
       Neither statements which begin with a SQL hint to force
       use of slave nor statements directed to a slave by an user-defined
       callback are included. The total number of statements sent to the slaves is 
       <i>use_slave</i> + <i>use_slave_sql_hint</i> +
       <i>use_slave_callback</i>.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>use_master</i>
      </td>
      <td align="left">
       Number of statements not considered as read-only by the built-in query analyzer.
       Neither statements which begin with a SQL hint to force
       use of master nor statements directed to a master by an user-defined
       callback are included. The total number of statements sent to the master is 
       <i>use_master</i> + <i>use_master_sql_hint</i> +
       <i>use_master_callback</i>.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>use_slave_sql_hint</i>
      </td>
      <td align="left">
       Number of statements sent to a slave because statement begins with
       the SQL hint to force use of slave.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>use_master_sql_hint</i>
      </td>
      <td align="left">
       Number of statements sent to a master because statement begins with
       the SQL hint to force use of master.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>use_last_used_sql_hint</i>
      </td>
      <td align="left">
       Number of statements sent to server which has run the previous statement,
       because statement begins with the SQL hint to force use of previously
       used server.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>use_slave_callback</i>
      </td>
      <td align="left">
       Number of statements sent to a slave because an user-defined callback
       has chosen a slave server for statement execution.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>use_master_callback</i>
      </td>
      <td align="left">
       Number of statements sent to a master because an user-defined callback
       has chosen a master server for statement execution.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>non_lazy_connections_slave_success</i>
      </td>
      <td align="left">
       Number of successfully opened slave connections from
       configurations not using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
       The total number of successfully opened slave connections
       is <i>non_lazy_connections_slave_success</i> + 
       <i>lazy_connections_slave_success</i>
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>non_lazy_connections_slave_failed</i>
      </td>
      <td align="left">
       Number of failed slave connection attempts from
       configurations not using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
       The total number of failed slave connection attempts
       is <i>non_lazy_connections_slave_failed</i> + 
       <i>lazy_connections_slave_failed</i>
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>non_lazy_connections_master_success</i>
      </td>
      <td align="left">
       Number of successfully opened master connections from
       configurations not using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
       The total number of successfully opened master connections
       is <i>non_lazy_connections_master_success</i> + 
       <i>lazy_connections_master_success</i>
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>non_lazy_connections_master_failed</i>
      </td>
      <td align="left">
       Number of failed master connection attempts from
       configurations not using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
       The total number of failed master connection attempts
       is <i>non_lazy_connections_master_failed</i> + 
       <i>lazy_connections_master_failed</i>
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>lazy_connections_slave_success</i>
      </td>
      <td align="left">
       Number of successfully opened slave connections from
       configurations using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>lazy_connections_slave_failed</i>
      </td>
      <td align="left">
       Number of failed slave connection attempts from
       configurations using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>lazy_connections_master_success</i>
      </td>
      <td align="left">
       Number of successfully opened master connections from
       configurations using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>lazy_connections_master_failed</i>
      </td>
      <td align="left">
       Number of failed master connection attempts from
       configurations using 
       <i><a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.lazy_connections" class="link">lazy connections</a></i>.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>trx_autocommit_on</i>
      </td>
      <td align="left">
       Number of <i>autocommit</i> mode activations via API calls.
       This figure may be used to monitor activity related to the plugin configuration
       setting
       <a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.trx_stickiness" class="link"><i>trx_stickiness</i></a>.
       If, for example, you want to know if a certain API call invokes the 
       <i>mysqlnd</i> library function <i>trx_autocommit()</i>,
       which is a requirement for 
       <a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.trx_stickiness" class="link"><i>trx_stickiness</i></a>,
       you may call the user API function in question and check if the 
       statistic has changed. The statistic is modified only by the
       plugins internal subclassed <i>trx_autocommit()</i>
       method.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>trx_autocommit_off</i>
      </td>
      <td align="left">
       Number of <i>autocommit</i> mode deactivations via API calls.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

     <tr valign="middle">
      <td align="left">
       <i>trx_master_forced</i>
      </td>
      <td align="left">
       Number of statemens redirected to the master while 
       <a href="mysqlnd-ms.plugin-ini.html#ini.mysqlnd-ms-plugin-config.trx_stickiness" class="link"><i>trx_stickiness=master</i></a>
       and <i>autocommit</i> mode is disabled.
      </td>
      <td align="left">Since 1.0.0.</td>
     </tr>

    </tbody>
   
  </table>

 </div>

 
 <div class="refsect1 examples" id="refsect1-function.mysqlnd-ms-get-stats-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-1630">
    <p><b>Example #1 <span class="function"><b>mysqlnd_ms_get_stats()</b></span> example</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysqlnd_ms.collect_statistics&nbsp;=&nbsp;%d\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ini_get</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysqlnd_ms.collect_statistics"</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_ms_get_stats</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
mysqlnd_ms.collect_statistics = 0
array(13) {
  [&quot;use_slave&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;use_master&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;use_slave_forced&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;use_master_forced&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;use_last_used_forced&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;non_lazy_connections_slave_success&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;non_lazy_connections_slave_failure&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;non_lazy_connections_master_success&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;non_lazy_connections_master_failure&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;lazy_connections_slave_success&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;lazy_connections_slave_failure&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;lazy_connections_master_success&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;lazy_connections_master_failure&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;trx_autocommit_on&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;trx_autocommit_off&quot;]=&gt;
  string(1) &quot;0&quot;
  [&quot;trx_master_forced&quot;]=&gt;
  string(1) &quot;0&quot;
}
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysqlnd-ms-get-stats-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member">
     <a href="mysqlnd-ms.configuration.html" class="link">Runtime configuration</a>
    </li>
    <li class="member">
     <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.collect_statistics" class="link">mysqlnd_ms.collect_statistics</a>
    </li>
    <li class="member">
     <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.enable" class="link">mysqlnd_ms.enable</a>
    </li>
   </ul>
  </p>
 </div>


</div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="ref.mysqlnd-ms.html">Mysqlnd_ms Functions</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysqlnd-ms-query-is-select.html">mysqlnd_ms_query_is_select</a></div>
 <div class="up"><a href="ref.mysqlnd-ms.html">Mysqlnd_ms Functions</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
